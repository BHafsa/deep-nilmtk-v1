

<!DOCTYPE html>
<html class="writer-html5" lang="python" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>deep_nilmtk.disaggregate package &mdash; deep_nilmtk 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="https://kit.fontawesome.com/##########.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="deep_nilmtk.loader package" href="deep_nilmtk.loader.html" />
    <link rel="prev" title="deep_nilmtk.config package" href="deep_nilmtk.config.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> deep_nilmtk
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">deep_nilmtk</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="deep_nilmtk.config.html">deep_nilmtk.config package</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">deep_nilmtk.disaggregate package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#module-deep_nilmtk.disaggregate.nilm_experiment">deep_nilmtk.disaggregate.nilm_experiment module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="deep_nilmtk.loader.html">deep_nilmtk.loader package</a></li>
<li class="toctree-l2"><a class="reference internal" href="deep_nilmtk.model.html">deep_nilmtk.model package</a></li>
<li class="toctree-l2"><a class="reference internal" href="deep_nilmtk.preprocessing.html">deep_nilmtk.preprocessing package</a></li>
<li class="toctree-l2"><a class="reference internal" href="deep_nilmtk.utils.html">deep_nilmtk.utils package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">deep_nilmtk</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="modules.html">deep_nilmtk</a> &raquo;</li>
        
      <li>deep_nilmtk.disaggregate package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/deep_nilmtk.disaggregate.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-deep_nilmtk.disaggregate">
<span id="deep-nilmtk-disaggregate-package"></span><h1>deep_nilmtk.disaggregate package<a class="headerlink" href="#module-deep_nilmtk.disaggregate" title="Permalink to this headline">¶</a></h1>
<p>Contains the definition of an abstarct disaggregator 
class that is compatible with all PyTorch models defined 
in the config module and is also compatible with the API 
of NILMtk.</p>
<div class="section" id="module-deep_nilmtk.disaggregate.nilm_experiment">
<span id="deep-nilmtk-disaggregate-nilm-experiment-module"></span><h2>deep_nilmtk.disaggregate.nilm_experiment module<a class="headerlink" href="#module-deep_nilmtk.disaggregate.nilm_experiment" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">deep_nilmtk.disaggregate.nilm_experiment.</span></span><span class="sig-name descname"><span class="pre">NILMExperiment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deep_nilmtk/disaggregate/nilm_experiment.html#NILMExperiment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment" title="Permalink to this definition">¶</a></dt>
<dd><p>This class defines a NILM experiment. It is compatibale with both
single and multi-appliance models and offers different advanced features 
like cross-validation and hyper-parametrs optimization during the 
training phase. The class is independent of the deep model used for 
load disaggregation.</p>
<p>** For a PyTorch model to be compatible with this class, an entry should be 
added for this model in the config module.</p>
<dl class="py method">
<dt class="sig sig-object py" id="deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment.disaggregate_chunk">
<span class="sig-name descname"><span class="pre">disaggregate_chunk</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">test_main_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_preprocessing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deep_nilmtk/disaggregate/nilm_experiment.html#NILMExperiment.disaggregate_chunk"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment.disaggregate_chunk" title="Permalink to this definition">¶</a></dt>
<dd><dl>
<dt>Uses trained models to disaggregate the test_main_list. It is</dt><dd><p>compatible with both single and multi-appliance models.</p>
</dd>
<dt>Args:</dt><dd><p>test_main_list ([type]): Aggregate power measurements.
do_preprocessing (bool, optional): Specify if pre-processing</p>
<blockquote>
<div><p>need to be done or not. Defaults to True.</p>
</div></blockquote>
</dd>
<dt>Returns:</dt><dd><p>[type]: Appliances power measurements.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment.get_net_and_loaders">
<span class="sig-name descname"><span class="pre">get_net_and_loaders</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/deep_nilmtk/disaggregate/nilm_experiment.html#NILMExperiment.get_net_and_loaders"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment.get_net_and_loaders" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an instance of the specified model and the correspanding dataloader</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>(model, data)[ nn.Module, torch.utils.data.Dataset]: model , dataloader</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment.objective">
<span class="sig-name descname"><span class="pre">objective</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trial</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_loader</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_loader</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fold_idx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deep_nilmtk/disaggregate/nilm_experiment.html#NILMExperiment.objective"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment.objective" title="Permalink to this definition">¶</a></dt>
<dd><p>The objective function to be used with optuna. This function requires the model under study to 
implement a static function called suggest_hparams() [see the model documentation for more informations]</p>
<dl class="simple">
<dt>Args:</dt><dd><p>trial ([type]): Optuna.trial
train_loader ([type], optional): training dataLoader for the current experiment. Defaults to None.
val_loader ([type], optional): validation dataLoader for the current experiment. Defaults to None.
fold_idx (int, optional): Number of the fold of cross-validation is used. Defaults to None.</p>
</dd>
<dt>Returns:</dt><dd><p>[int]: The best validation loss aschieved</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment.objective_cv">
<span class="sig-name descname"><span class="pre">objective_cv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trial</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deep_nilmtk/disaggregate/nilm_experiment.html#NILMExperiment.objective_cv"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment.objective_cv" title="Permalink to this definition">¶</a></dt>
<dd><p>The objective function for Optuna when cross-validation is also used</p>
<dl class="simple">
<dt>Args:</dt><dd><p>trial (Optuna.trial): An optuna trial</p>
</dd>
<dt>Returns:</dt><dd><p>[type]: average of best loss validations for considered folds</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment.partial_fit">
<span class="sig-name descname"><span class="pre">partial_fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sub_main</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_preprocessing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">load_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deep_nilmtk/disaggregate/nilm_experiment.html#NILMExperiment.partial_fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment.partial_fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Trains the model for appliances according to the model name specified 
in the experiment's definition. It starts with the data pre-processing and 
formatting and then train the model based on the type of the model(single 
or multi-task).</p>
<p>TODO: Implement the multi-appliance disaggregtaion function</p>
<dl class="simple">
<dt>Args:</dt><dd><p>mains ([type]): Aggregate power measurements.
sub_main ([type]): Appliances power measurements.
do_preprocessing (bool, optional): Performs pre-processing or not. Defaults to True.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment.save_best_model">
<span class="sig-name descname"><span class="pre">save_best_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">study</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trial</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deep_nilmtk/disaggregate/nilm_experiment.html#NILMExperiment.save_best_model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment.save_best_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Keeps track of the trial giving best results</p>
<dl class="simple">
<dt>Args:</dt><dd><p>study ([type]): Optuna study
trial ([type]): Optuna trial</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment.single_appliance_disaggregate">
<span class="sig-name descname"><span class="pre">single_appliance_disaggregate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">test_main_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_preprocessing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deep_nilmtk/disaggregate/nilm_experiment.html#NILMExperiment.single_appliance_disaggregate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment.single_appliance_disaggregate" title="Permalink to this definition">¶</a></dt>
<dd><p>Perfroms load disaggregtaion for single appliance models. If Optuna was used during the 
training phase, it disaggregtaes the test_main_list using only the best trial. 
If cross-validation is used during training, it returns the average of predictions 
cross all folds for each applaince. In this later case, the predictions for each fold 
are also logged in the results folder under the name 
['model_name']_[appliance_name]_all_folds_predictions.p. 
Alternatively, when both Optuna and cross-validation are used, it returns the average predictions 
of all folds for only the best trial.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>test_main_list ([type]): Aggregate power measurements
model (Ordered_dic, optional): Pre-trained appliance's models. Defaults to None.
do_preprocessing (bool, optional): [description]. Defaults to True.</p>
</dd>
<dt>Returns:</dt><dd><p>dict: estimated power consumption of the considered appliances.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment.single_appliance_fit">
<span class="sig-name descname"><span class="pre">single_appliance_fit</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/deep_nilmtk/disaggregate/nilm_experiment.html#NILMExperiment.single_appliance_fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment.single_appliance_fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Train the specified models for each appliance separately taking into consideration
the use of cross-validation and hyper-parameters optimisation. The checkpoints for 
each model are saved in the correspondng path.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment.train_model">
<span class="sig-name descname"><span class="pre">train_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">appliance_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_loader</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_loader</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exp_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">std</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trial_idx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fold_idx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/deep_nilmtk/disaggregate/nilm_experiment.html#NILMExperiment.train_model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#deep_nilmtk.disaggregate.nilm_experiment.NILMExperiment.train_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Trains a single PyTorch model.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>appliance_name ([str]): Name of teh appliance to be modeled
train_loader ([DataLoader]): training dataLoader for the current appliance
val_loader (DataLoader): validation dataLoader for the current appliance
exp_name ([str]): the name of teh experiment
mean ([float], optional): mean value of the target appliance power. Defaults to None.
std ([float], optional): std value of the target applaince power. Defaults to None.
trial_idx ([int], optional): ID of teh current optuna trial if optuna is used. Defaults to None.
fold_idx ([int], optional): number of the fold if CV is used. Defaults to None.
model ([type], optional): Lightning model of the current appliance. Defaults to None.</p>
</dd>
<dt>Returns:</dt><dd><dl class="simple">
<dt>[int, str]: in the case of using Optuna, it return the best </dt><dd><p>validation loss and the path to the best checkpoint.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="deep_nilmtk.loader.html" class="btn btn-neutral float-right" title="deep_nilmtk.loader package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="deep_nilmtk.config.html" class="btn btn-neutral float-left" title="deep_nilmtk.config package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Boubsiat Hafsa.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>